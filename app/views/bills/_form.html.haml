- content_for :h2_field do
  = f.label :reference, t("assur.bill.Reference"), :class => :label
  = f.text_field :reference, :class => 'text_field'
- content_for :javascripts do
  = javascript_tag do
    = "var product='#{generate_template(f, :products)}'"
  = javascript_include_tag 'autocomplete', 'bill'
- content_for :css do
  = stylesheet_link_tag "autocomplete"
= render "shared/error_messages", :target => @bill
.group
  .columns.wat-cf 
    .verylargecolumn.left     
      = f.label :name, t("assur.bill.Description") + mark_required(@bill, :name), :class => :label
      = f.text_field :name, :class => 'text_field focus'
    .verysmallcolumn.right
      = f.label :reference, t("assur.bill.Reference") + mark_required(@bill, :reference), :class => :label
      %span.in_place_edit{:target => 'bill_reference'}
        %span.readonly= @bill.reference
        = text_field_tag 'bill[reference]', @bill.reference, :class => 'in_place_edit_text_field', :style => 'display:none'
.group
  .columns.wat-cf 
    .column.left     
      = f.label :customer_id, t("assur.bill.Customer") + mark_required(@bill, :customer_id), :class => :label
      %span.in_place_edit{:target => 'bill_customer_id'}
        %span.readonly= @bill.customer_fullname_with_reference
        = text_field_tag 'customer_autocomplete', @bill.customer_fullname_with_reference , :class => 'in_place_edit_text_field', :style => 'display:none'
        = f.hidden_field :customer_id
        %span.description{:style => 'display:none;'}
          Entrez minimum 2 caracteres du nom, prenom ou de la reference client
          = link_to 'aide', '#'
    .column.right
      = f.label :effective_date, t("assur.bill.Effective_date") + mark_required(@bill, :effective_date), :class => :label
      %span.in_place_edit{:target => 'bill_location'}
        %span.readonly= @bill.location_for_bill(current_user.company)
        = text_field_tag 'bill[location]', @bill.location_for_bill(current_user.company), :class => 'in_place_edit_text_field', :style => 'display:none'
        = " #{t('assur.bill.location')}"
      = f.date_select :effective_date, :start_year => Time.now.year-2, :end_year => Time.now.year+2, :class => 'text_field'
%table.table{:id => 'products'}
  %thead
    %tr
      %th{:width => '54%'}= t('assur.product.Product_name_description')
      %th{:width => '10%'}= t('assur.product.Quantity')
      %th{:width => '10%'}= t('assur.product.Unit_price')
      %th{:width => '10%'}= t('assur.product.VAT')
      %th= t('assur.product.Total_HVAT')
      %th= t('assur.product.Total_VAT')
      %th &nbsp;
  %tbody
    = f.fields_for :products do |p|
      = render :partial => 'product', :locals => {:f => p}
  %tfoot
    %tr.strong.greybg
      %td.text-right &nbsp;
      %td &nbsp;
      %td.text-right= t('assur.product.Total')
      %td.text-right &nbsp;
      %td.text-right{:id => 'globaltotalhtva'}
      %td.text-right{:id => 'globaltotaltvac'}
      %td &nbsp;
= f.hidden_field :totalhtva
= f.hidden_field :totaltvac
.group
  .columns.wat-cf
    = link_to  image_tag("web-app-theme/icons/add.png" , :alt => t('assur.product.Add_product')) + " " + t("assur.product.Add_product"), '#product', :class => "button add_nested_item", :rel => "products"
.group
  = f.label :note, t("assur.bill.note") + mark_required(@bill, :note), :class => :label
  = f.text_area :note, :class => 'text_area', :rows => 5
  %span.description= t 'assur.bill.config_note_help'
.group.navform
  .columns.wat-cf
    .column.left
      %button.button{:type => "button", :onclick => 'document.forms[0].submit();'}
        = image_tag("web-app-theme/icons/tick.png", :alt => "#{t("assur.general.save")}")
        = t("assur.general.save")
      = link_to image_tag("web-app-theme/icons/cross.png", :alt => t("assur.general.cancel")) + " " + t("assur.general.cancel"), customers_path, :class => "button"
    - unless f.object.new_record?
      .column.right
        = link_to image_tag("web-app-theme/icons/bin.png", :alt => t("assur.general.delete")) + " " + t("assur.general.delete"), bill_path(@bill), :class => "button rbutton", :method => :delete, :confirm => t("assur.general.are_you_sure")